version: 2.1

jobs:
  test_against_mruby:
    parameters:
      version:
        description: "Version of mruby to test against"
        type: string
    environment:
      MRUBY_CONFIG: /project/.travis_build_config.rb
    working_directory: /project
    docker:
      - image: ruby:2.6.2 # not really important, but...
    steps:
      - checkout
      - run: apt-get update -qq && apt-get install -y -qq bison
      - run: git clone --depth 1 --branch << parameters.version >> https://github.com/mruby/mruby.git
      - run: |
          cd mruby
          ./minirake test

workflows:
  version: 2
  test:
    jobs:
      - test_against_mruby:
          version: "1.3.0"
      - test_against_mruby:
          version: "1.4.0"
      - test_against_mruby:
          version: "1.4.1"
      - test_against_mruby:
          version: "2.0.0"
      - test_against_mruby:
          version: "2.0.1"
      - test_against_mruby:
          version: "master"
